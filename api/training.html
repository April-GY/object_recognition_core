<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Training &mdash; object_recognition_core</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/breathe.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="object_recognition_core" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">object_recognition_core</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/or.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Training</a><ul>
<li><a class="reference internal" href="#database-cell">Database Cell</a><ul>
<li><a class="reference internal" href="#step-1">Step 1</a></li>
<li><a class="reference internal" href="#step-2">Step 2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-plasm">Python Plasm</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/api/training.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="training">
<h1>Training<a class="headerlink" href="#training" title="Permalink to this headline">¶</a></h1>
<div class="section" id="database-cell">
<h2>Database Cell<a class="headerlink" href="#database-cell" title="Permalink to this headline">¶</a></h2>
<p>When creating your training pipeline, you will want to store your model in the database.
By using our interface you will
save a lot of time. Creating such a cell is easy and
it will automatically add the following fields to
the model when persisted:</p>
<ul class="simple">
<li>the object id</li>
<li>the model parameters</li>
<li>the fact that the document is a model, of the type given by the member function <tt class="docutils literal"><span class="pre">model_type</span></tt></li>
</ul>
<div class="section" id="step-1">
<h3>Step 1<a class="headerlink" href="#step-1" title="Permalink to this headline">¶</a></h3>
<p>First, you will need to create a cell that implements what is added to the DB document. It has to inherit from
<tt class="docutils literal"><span class="pre">db::bases::ModelWriterImpl</span></tt>. An example implementation is:</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">struct</span> <span class="nl">MyAwesomeModelWriterImpl</span><span class="p">:</span> <span class="k">public</span> <span class="n">db</span><span class="o">::</span><span class="n">bases</span><span class="o">::</span><span class="n">ModelWriterImpl</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// You can define the declare_params and configure functions if needed</span>

  <span class="c1">// This is the standard ecto cell declare_io</span>
  <span class="k">static</span> <span class="kt">void</span>
  <span class="n">declare_io</span><span class="p">(</span><span class="k">const</span> <span class="n">ecto</span><span class="o">::</span><span class="n">tendrils</span><span class="o">&amp;</span> <span class="n">params</span><span class="p">,</span> <span class="n">ecto</span><span class="o">::</span><span class="n">tendrils</span><span class="o">&amp;</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">ecto</span><span class="o">::</span><span class="n">tendrils</span><span class="o">&amp;</span> <span class="n">outputs</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">inputs</span><span class="p">.</span><span class="n">declare</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MyAwesomeModelWriterImpl</span><span class="o">::</span><span class="n">model_part_</span><span class="p">,</span> <span class="s">&quot;model_part&quot;</span><span class="p">,</span> <span class="s">&quot;A part of the model.&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Note how this function has an extra argument: the db::Document</span>
  <span class="k">virtual</span> <span class="kt">int</span>
  <span class="n">process</span><span class="p">(</span><span class="k">const</span> <span class="n">ecto</span><span class="o">::</span><span class="n">tendrils</span><span class="o">&amp;</span> <span class="n">inputs</span><span class="p">,</span> <span class="k">const</span> <span class="n">ecto</span><span class="o">::</span><span class="n">tendrils</span><span class="o">&amp;</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">db</span><span class="o">::</span><span class="n">Document</span><span class="o">&amp;</span> <span class="n">doc</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">doc</span><span class="p">.</span><span class="n">set_attachment</span><span class="o">&lt;</span><span class="n">ModelPartType</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;model_part&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">model_part_</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ecto</span><span class="o">::</span><span class="n">OK</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// The DB needs to know the type of your model, to differentiate it from other methods</span>
  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span>
  <span class="n">model_type</span><span class="p">()</span> <span class="k">const</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;My awesome model&quot;</span><span class="p">;</span>
  <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
  <span class="n">ecto</span><span class="o">::</span><span class="n">spore</span><span class="o">&lt;</span><span class="n">ModelPartType</span><span class="o">&gt;</span> <span class="n">model_part_</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>The <tt class="docutils literal"><span class="pre">process</span></tt> function fills your document with everything that makes your model specific. Use the <tt class="docutils literal"><span class="pre">set_value</span></tt> to add fields that can be searched (strings, numerals) and the <tt class="docutils literal"><span class="pre">set_attachment</span></tt>
member function of the <tt class="docutils literal"><span class="pre">db::Document</span></tt> to fill the different binary blobs of the model. If your type is not supported, you
will have to implement the following member functions (and please send us a patch containing them if it is a very common type):</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">template</span><span class="o">&lt;&gt;</span>
<span class="kt">void</span>
<span class="n">Document</span><span class="o">::</span><span class="n">get_attachment</span><span class="o">&lt;</span><span class="n">YourType</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">AttachmentName</span> <span class="o">&amp;</span><span class="n">attachment_name</span><span class="p">,</span> <span class="n">YourType</span> <span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;&gt;</span>
<span class="kt">void</span>
<span class="n">Document</span><span class="o">::</span><span class="n">get_attachment_and_cache</span><span class="o">&lt;</span><span class="n">YourType</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">AttachmentName</span> <span class="o">&amp;</span><span class="n">attachment_name</span><span class="p">,</span> <span class="n">YourType</span> <span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>

<span class="k">template</span><span class="o">&lt;&gt;</span>
<span class="kt">void</span>
<span class="n">Document</span><span class="o">::</span><span class="n">set_attachment</span><span class="o">&lt;</span><span class="n">YourType</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">AttachmentName</span> <span class="o">&amp;</span><span class="n">attachment_name</span><span class="p">,</span> <span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>(we provide a default <tt class="docutils literal"><span class="pre">boost</span></tt> serialization but to make sure the binary blobs are readable on machines with a different
<tt class="docutils literal"><span class="pre">boost</span> <span class="pre">serialization</span></tt> library, you should probably implement your own serialization)</p>
</div>
<div class="section" id="step-2">
<h3>Step 2<a class="headerlink" href="#step-2" title="Permalink to this headline">¶</a></h3>
<p>Very important, you need to actually define a type for your cell based on ModelWriterBase. Something like this suffices:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">typedef</span> <span class="n">db</span><span class="o">::</span><span class="n">bases</span><span class="o">::</span><span class="n">ModelWriterBase</span><span class="o">&lt;</span><span class="n">MyAwesomeModelWriterImpl</span><span class="o">&gt;</span> <span class="n">MyAwesomeModelWriterCell</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="python-plasm">
<h2>Python Plasm<a class="headerlink" href="#python-plasm" title="Permalink to this headline">¶</a></h2>
<p>Your pipeline also has to provide an implementation of the <tt class="xref py py-class docutils literal"><span class="pre">object_recognition_core.pipelines.training.TrainingPipeline</span></tt> class so that
<tt class="docutils literal"><span class="pre">ORK</span></tt> can find it (as it will be on the <tt class="docutils literal"><span class="pre">PYTHONPATH</span></tt>), generate docs for it and do everything that is basically not the raw computation.</p>
<dl class="class">
<dt id="object_recognition_core.pipelines.training.TrainerBase">
<em class="property">class </em><tt class="descclassname">object_recognition_core.pipelines.training.</tt><tt class="descname">TrainerBase</tt><a class="reference internal" href="../_modules/object_recognition_core/pipelines/training.html#TrainerBase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#object_recognition_core.pipelines.training.TrainerBase" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a base class for a training pipeline: you don&#8217;t need to have your pipeline cell inherit from that class
but if you do, it will be listed as an official training pipeline
You need to call the BlackBox constructor in your __init__ first and then this function. Typically, your __init__ is</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">ecto</span><span class="o">.</span><span class="n">BlackBox</span><span class="p">,</span> <span class="n">TrainerBase</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ecto</span><span class="o">.</span><span class="n">BlackBox</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">TrainerBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">object_recognition_core</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013,  Willow Garage, Inc.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>